{"version":3,"sources":["../src/progresschart_ctrl.js"],"names":["MetricsPanelCtrl","Draw","_","unit","kbn","ProgressChartCtrl","$scope","$injector","$rootScope","hiddenSeries","panelDefaults","colorArr","progressArr","barsArr","doughnutsArr","dataTemp","defaults","panel","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","addEditorTab","unitFormats","getUnitFormats","subItem","obj","format","value","valueShow","formatValue","render","series","data","parseSeries","checkProgressArr","length","checkSeries","targets","forEach","index","arr","datapoints","perValue","percent","total","proLen","perTotal","i","indTmp","Math","round","floor","draw","getDOM","seriesData","dataList","map","seriesHandler","proObj","console","log","document","querySelectorAll","clientWidth","clientHeight","objTempEdit","label","type","objTemp","push","splice","domList","dom","width","height","children","len","scope","elem","$panelContainer","find","$progressPanel","css","offsetHeight","templateUrl"],"mappings":"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","file":"progresschart_ctrl.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport  { Draw } from './draw'\r\nimport _ from 'lodash';\r\nimport unit from './unit';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport './css/panel.css!';\r\n\r\nexport class ProgressChartCtrl extends MetricsPanelCtrl {\r\n\r\n\tconstructor($scope, $injector, $rootScope) {\r\n\t\tsuper($scope, $injector);\r\n\t\tthis.$rootScope = $rootScope;\r\n\t\tthis.hiddenSeries = {};\r\n\r\n\t\tvar panelDefaults = {\r\n\t\t\tcolorArr: ['#5eb1e4', '#4888e0', '#2adf6e', '#FFB90F', '#FF4500'],\r\n\t\t\tprogressArr: [],\r\n\t\t\tbarsArr: [],\r\n\t\t\tdoughnutsArr: [],\r\n\t\t};\r\n\r\n\t\tthis.dataTemp = {\r\n\t\t\tprogressArr: [],\r\n\t\t\tbarsArr: [],\r\n\t\t\tdoughnutsArr: [],\r\n\t\t};\r\n\r\n\t\t_.defaults(this.panel, panelDefaults);\r\n\r\n\t\tthis.events.on('render', this.onRender.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('data-error', this.onDataError.bind(this));\r\n\t\tthis.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\t}\r\n\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Options', 'public/plugins/grafana-progress-panel/editor.html', 2);\r\n\t\tthis.unitFormats = kbn.getUnitFormats();\r\n\t}\r\n\r\n\tsetUnitFormat(subItem, obj) {\r\n\t\tobj.format = subItem.value;\r\n\t\tobj.valueShow = unit.formatValue(this.panel, obj.value, subItem.value);\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tonDataError() {\r\n\t\tthis.series = [];\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tonRender() {\r\n\t\tthis.data = this.parseSeries(this.series);\r\n\t}\r\n\r\n\tparseSeries(series) {\r\n\t\tthis.dataTemp = {\r\n\t\t\tprogressArr: unit.checkProgressArr(this.panel.progressArr, this.dataTemp.progressArr),\r\n\t\t\tbarsArr: unit.checkProgressArr(this.panel.barsArr, this.dataTemp.barsArr),\r\n\t\t\tdoughnutsArr: unit.checkProgressArr(this.panel.doughnutsArr, this.dataTemp.doughnutsArr)\r\n\t\t};\r\n\t\tif (series && series.length > 0) {\r\n\t\t\tseries = unit.checkSeries(this.panel.targets, series);\r\n\t\t\tthis.dataTemp.progressArr.forEach((value, index, arr) => {\r\n\t\t\t\tif (series[index] && series[index].datapoints) {\r\n\t\t\t\t\tlet datapoints = series[index].datapoints;\r\n\t\t\t\t\tif (datapoints.length > 0) {\r\n\t\t\t\t\t\tvalue.value = datapoints[datapoints.length - 1][0];\r\n\t\t\t\t\t\tvalue.valueShow = unit.formatValue(this.panel, value.value, this.panel.progressArr[index].format);\r\n\t\t\t\t\t\tlet perValue = datapoints[datapoints.length - 1][0];\r\n\t\t\t\t\t\tif (perValue > 100) {\r\n\t\t\t\t\t\t\tperValue = 100;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (perValue < 0) {\r\n\t\t\t\t\t\t\tperValue = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvalue.percent = perValue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue.value = 0;\r\n\t\t\t\t\t\tvalue.valueShow = 'N/A';\r\n\t\t\t\t\t\tvalue.percent = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\tlet total = 0,\r\n\t\t\t\tproLen = this.panel.progressArr.length,\r\n\t\t\t\tperTotal = 0;\r\n\t\t\tfor (var i = 0; i < this.dataTemp.barsArr.length; i++) {\r\n\t\t\t\tlet indTmp = proLen + i;\r\n\t\t\t\tif (series[indTmp] && series[indTmp].datapoints) {\r\n\t\t\t\t\tlet datapoints = series[indTmp].datapoints;\r\n\t\t\t\t\tif (datapoints.length > 0) {\r\n\t\t\t\t\t\tthis.dataTemp.barsArr[i].value = datapoints[datapoints.length - 1][0];\r\n\t\t\t\t\t\ttotal = Math.round(total) + Math.round(this.dataTemp.barsArr[i].value);\r\n\t\t\t\t\t\tthis.dataTemp.barsArr[i].valueShow = unit.formatValue(this.panel, this.dataTemp.barsArr[i].value, this.panel.barsArr[i].format);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.dataTemp.barsArr[i].value = 0;\r\n\t\t\t\t\t\tthis.dataTemp.barsArr[i].valueShow = 'N/A';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttotal = Math.round(total) + Math.round(this.dataTemp.barsArr[i].value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.dataTemp.barsArr.forEach((value, index, arr) => {\r\n\t\t\t\tif (index == arr.length - 1) {\r\n\t\t\t\t\tvalue.percent = 100 - perTotal;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (value.value) {\r\n\t\t\t\t\t\tvalue.percent = (value.value / total) * 100;\r\n\t\t\t\t\t\tvalue.percent = Math.floor(value.percent);\r\n\t\t\t\t\t\tperTotal += value.percent;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue.percent = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// -----------------------------------------------------------------Doughnut 数据处理-----------------------------------------------------------------\r\n\t\t\tthis.draw(this.getDOM());\r\n\t\t} else {\r\n\t\t\tthis.dataTemp.progressArr.forEach((value, index, arr) => {\r\n\t\t\t\tvalue.value = 0;\r\n\t\t\t\tvalue.valueShow = 'N/A';\r\n\t\t\t\tvalue.percent = 0;\r\n\t\t\t})\r\n\t\t\tthis.dataTemp.barsArr.forEach((value, index, arr) => {\r\n\t\t\t\tvalue.value = 0;\r\n\t\t\t\tvalue.percent = index == 0 ? 100 : 0;\r\n\t\t\t\tvalue.valueShow = 'N/A';\r\n\t\t\t})\r\n\t\t\t// -----------------------------------------------------------------Doughnut 空数据处理-----------------------------------------------------------------\r\n\t\t\tthis.draw(this.getDOM());\r\n\t\t}\r\n\t\treturn this.dataTemp;\r\n\t}\r\n\r\n\tseriesHandler(seriesData) {\r\n\t\treturn seriesData;\r\n\t}\r\n\r\n\tonDataReceived(dataList) {\r\n\t\tthis.series = dataList.map(this.seriesHandler.bind(this));\r\n\t\tthis.data = this.parseSeries(this.series);\r\n\t\tthis.render(this.data);\r\n\t}\r\n\r\n\tgetProcessStyle(proObj) {\r\n\t\treturn { 'width': proObj && proObj.percent ? proObj.percent + \"%\" : 0 + '%' };\r\n\t}\r\n\r\n\tgetBarStyle(index) {\r\n\t\treturn { 'width': this.dataTemp.barsArr[index].percent + '%', 'background-color': this.panel.colorArr[index] };\r\n\t}\r\n\t\r\n\t// -----------------------------------------------------------------Doughnut 样式获取-----------------------------------------------------------------\r\n\tgetDoughnutStyle(index) {\r\n\t\tconsole.log(\"progresschart.js/getDoughnutStyle is run.\");\r\n\r\n\t\treturn {\r\n\t\t\t'width': document.querySelectorAll(\".doughnut-contanier\")[index].clientWidth,\r\n\t\t\t// 'height': \"100px\",\r\n\t\t\t'height': document.querySelectorAll(\".doughnut-contanier\")[index].clientHeight,\r\n\t\t}\r\n\t}\r\n\r\n\taddProgress() {\r\n\t\tlet objTempEdit = {\r\n\t\t\tlabel: '', unit: '', type: 'solid', format: 'short'\r\n\t\t},\r\n\t\t\tobjTemp = { value: 0, valueShow: '', percent: 0 };\r\n\t\tthis.panel.progressArr.push(objTempEdit);\r\n\t\tthis.dataTemp.progressArr.push(objTemp);\r\n\t}\r\n\r\n\taddBarMember() {\r\n\t\tlet objTempEdit = {\r\n\t\t\tlabel: '', unit: '', format: 'short'\r\n\t\t},\r\n\t\tobjTemp = { value: 0, valueShow: '', percent: 0 };\r\n\t\tthis.panel.barsArr.push(objTempEdit);\r\n\t\tthis.dataTemp.barsArr.push(objTemp);\r\n\t}\r\n\r\n\t// -----------------------------------------------------------------Doughnut DOM 添加-----------------------------------------------------------------\r\n\taddDoughnutMember() {\r\n\t\tlet objTempEdit = {\r\n\t\t\tlabel: ''\r\n\t\t},\r\n\t\tobjTemp = { value: 0, valueShow: '', percent: 0 };\r\n\t\tthis.panel.doughnutsArr.push(objTempEdit);\r\n\t\tthis.dataTemp.doughnutsArr.push(objTemp);\r\n\t}\r\n\r\n\tdelProgress(index) {\r\n\t\tthis.panel.progressArr.splice(index, 1);\r\n\t\tthis.dataTemp.progressArr.splice(index, 1);\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tdelBarMember(index) {\r\n\t\tthis.panel.barsArr.splice(index, 1);\r\n\t\tthis.dataTemp.barsArr.splice(index, 1);\r\n\t\tlet total = 0;\r\n\t\tthis.dataTemp.barsArr.forEach((value, index, arr) => {\r\n\t\t\ttotal = Math.round(total) + Math.round(value.value);\r\n\t\t});\r\n\t\tthis.dataTemp.barsArr.forEach((value, index, arr) => {\r\n\t\t\tif (total === 0) {\r\n\t\t\t\tvalue.percent = index == 0 ? 100 : 0;\r\n\t\t\t} else {\r\n\t\t\t\tvalue.percent = (value.value / total) * 100;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.render();\r\n\t}\r\n\r\n\t// -----------------------------------------------------------------Doughnut DOM 删除-----------------------------------------------------------------\r\n\tdelDoughnutMember(index) {\r\n\t\tthis.panel.doughnutsArr.splice(index, 1);\r\n\t\tthis.dataTemp.doughnutsArr.splice(index, 1);\r\n\t\tthis.render();\r\n\t}\r\n\r\n\t// -----------------------------------------------------------------Doughnut DOM 绘画-----------------------------------------------------------------\r\n\tdraw(domList) {\r\n\t\tconsole.log(\"progresschart.js/draw is run.\");\r\n\t\tconsole.log(\"domList\", domList);\r\n\t\tfor(let i in domList) {\r\n\t\t\tlet dom = domList[i];\r\n\t\t\tconsole.log(dom);\r\n\t\t\tDraw({\r\n\t\t\t\tdom: dom,\r\n\t\t\t\twidth: dom.clientWidth,\r\n\t\t\t\theight: dom.clientHeight,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\tgetDOM() {\r\n\t\tlet domList = [];\r\n\t\tfor(let i in this.panel.doughnutsArr) {\r\n\t\t\tif(document.querySelectorAll(\".doughnut-contanier\")[i]) {\r\n\t\t\t\tdomList.push(document.querySelectorAll(\".doughnut-contanier\")[i].children[1]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn domList;\r\n\t}\r\n\r\n\tdoughnutInit(index, len) {\r\n\t\tconsole.log(\"this.doughnutsArr.length\", len);\r\n\t\tconsole.log(\"index\", index);\r\n\t\tlet arr = [];\r\n\t\tif(index == (len - 1)){\r\n\t\t\tfor(let i = 0; i < len; i++){\r\n\t\t\t\tlet dom = document.querySelectorAll(\".doughnut-contanier\")[i].children[1];\r\n\t\t\t\tarr.push(dom);\r\n\t\t\t}\r\n\t\t\tconsole.log(\"arr\", arr);\r\n\t\t\tthis.draw(arr);\r\n\t\t}\r\n\t}\r\n\r\n\tlink(scope, elem) {\r\n\t\tthis.events.on('render', () => {\r\n\t\t\tconst $panelContainer = elem.find('.panel-container');\r\n\t\t\tconst $progressPanel = elem.find('.progress-panel');\r\n\t\t\t$progressPanel.css('height', ($panelContainer[0].offsetHeight - 40) + 'px');\r\n\t\t});\r\n\t}\r\n}\r\n\r\nProgressChartCtrl.templateUrl = 'module.html';\r\n"]}