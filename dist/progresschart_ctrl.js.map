{"version":3,"sources":["../src/progresschart_ctrl.js"],"names":["MetricsPanelCtrl","Draw","_","unit","kbn","ProgressChartCtrl","$scope","$injector","$rootScope","hiddenSeries","panelDefaults","colorArr","progressArr","barsArr","barsArr2","doughnutsArr","dataTemp","defaults","panel","events","on","onRender","bind","onDataReceived","onDataError","onInitEditMode","addEditorTab","unitFormats","getUnitFormats","subItem","obj","format","value","valueShow","formatValue","render","series","data","parseSeries","checkProgressArr","console","log","targets","length","checkSeries","forEach","index","arr","datapoints","perValue","target","percent","total","proLen","perTotal","i","indTmp","Math","round","floor","total2","perTotal2","barLen","barLen2","dnList","getDoughnutList","map","item","cursor","active","inactive","push","dom","draw","seriesData","dataList","seriesHandler","proObj","objTempEdit","label","type","objTemp","autoID","document","querySelectorAll","id","splice","list","width","clientWidth","height","domList","children","$event","scope","elem","$panelContainer","find","$progressPanel","css","offsetHeight","templateUrl"],"mappings":"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","file":"progresschart_ctrl.js","sourcesContent":["import { MetricsPanelCtrl } from 'app/plugins/sdk';\r\nimport  { Draw } from './draw'\r\nimport _ from 'lodash';\r\nimport unit from './unit';\r\nimport kbn from 'app/core/utils/kbn';\r\nimport './css/panel.css!';\r\n\r\nexport class ProgressChartCtrl extends MetricsPanelCtrl {\r\n\r\n\tconstructor($scope, $injector, $rootScope) {\r\n\t\tsuper($scope, $injector);\r\n\t\tthis.$rootScope = $rootScope;\r\n\t\tthis.hiddenSeries = {};\r\n\r\n\t\tvar panelDefaults = {\r\n\t\t\tcolorArr: ['#5eb1e4', '#4888e0', '#2adf6e', '#FFB90F', '#FF4500'],\r\n\t\t\tprogressArr: [],\r\n\t\t\tbarsArr: [],\r\n\t\t\tbarsArr2: [],\r\n\t\t\tdoughnutsArr: [],\r\n\t\t};\r\n\r\n\t\tthis.dataTemp = {\r\n\t\t\tprogressArr: [],\r\n\t\t\tbarsArr: [],\r\n\t\t\tbarsArr2: [],\r\n\t\t\tdoughnutsArr: [],\r\n\t\t};\r\n\r\n\t\t_.defaults(this.panel, panelDefaults);\r\n\r\n\t\tthis.events.on('render', this.onRender.bind(this));\r\n\t\tthis.events.on('data-received', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('data-error', this.onDataError.bind(this));\r\n\t\tthis.events.on('data-snapshot-load', this.onDataReceived.bind(this));\r\n\t\tthis.events.on('init-edit-mode', this.onInitEditMode.bind(this));\r\n\t}\r\n\r\n\tonInitEditMode() {\r\n\t\tthis.addEditorTab('Options', 'public/plugins/grafana-progress-panel/editor.html', 2);\r\n\t\tthis.unitFormats = kbn.getUnitFormats();\r\n\t}\r\n\r\n\tsetUnitFormat(subItem, obj) {\r\n\t\tobj.format = subItem.value;\r\n\t\tobj.valueShow = unit.formatValue(this.panel, obj.value, subItem.value);\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tonDataError() {\r\n\t\tthis.series = [];\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tonRender() {\r\n\t\tthis.data = this.parseSeries(this.series);\r\n\t}\r\n\r\n\tparseSeries(series) {\r\n\t\t// Doughnut 测试数据\r\n\t\tthis.dataTemp = {\r\n\t\t\tprogressArr: unit.checkProgressArr(this.panel.progressArr, this.dataTemp.progressArr),\r\n\t\t\tbarsArr: unit.checkProgressArr(this.panel.barsArr, this.dataTemp.barsArr),\r\n\t\t\tbarsArr2: unit.checkProgressArr(this.panel.barsArr2, this.dataTemp.barsArr2),\r\n\t\t\tdoughnutsArr: unit.checkProgressArr(this.panel.doughnutsArr, this.dataTemp.doughnutsArr)\r\n\t\t};\r\n\t\tconsole.log(\"Doughnut 获取数据 : series\",series);\r\n\t\tconsole.log(\"Doughnut 获取数据 : targets\",this.panel.targets);\r\n\t\tif (series && series.length > 0) {\r\n\t\t\tseries = unit.checkSeries(this.panel.targets, series);\r\n\t\t\t// -----------------------------------------------------------------Progress 数据处理-----------------------------------------------------------------\r\n\t\t\tthis.dataTemp.progressArr.forEach((value, index, arr) => {\r\n\t\t\t\tif (series[index] && series[index].datapoints) {\r\n\t\t\t\t\tlet datapoints = series[index].datapoints;\r\n\t\t\t\t\tif (datapoints.length > 0) {\r\n\t\t\t\t\t\tvalue.value = datapoints[datapoints.length - 1][0];\r\n\t\t\t\t\t\tvalue.valueShow = unit.formatValue(this.panel, value.value, this.panel.progressArr[index].format);\r\n\t\t\t\t\t\tlet perValue = datapoints[datapoints.length - 1][0];\r\n\t\t\t\t\t\tif (perValue > 100) {\r\n\t\t\t\t\t\t\tperValue = 100;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (perValue < 0) {\r\n\t\t\t\t\t\t\tperValue = 0;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t// RAC视图 SQL提交 Log Buffer Hit特殊处理\r\n\t\t\t\t\t\tif(series[index].target == \"Log buffer space waits\") {\r\n\t\t\t\t\t\t\tif(perValue == 0) {\r\n\t\t\t\t\t\t\t\tperValue = 100;\r\n\t\t\t\t\t\t\t\tvalue.valueShow = '100%';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tperValue = 90;\r\n\t\t\t\t\t\t\t\tvalue.valueShow = '90%';\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tvalue.percent = perValue;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue.value = 0;\r\n\t\t\t\t\t\tvalue.valueShow = 'N/A';\r\n\t\t\t\t\t\tvalue.percent = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t\tlet total = 0, proLen = this.panel.progressArr.length, perTotal = 0;\r\n\t\t\t// -----------------------------------------------------------------Bar 数据处理-----------------------------------------------------------------\r\n\t\t\tfor (var i = 0; i < this.dataTemp.barsArr.length; i++) {\r\n\t\t\t\tlet indTmp = proLen + i;\r\n\t\t\t\tif (series[indTmp] && series[indTmp].datapoints) {\r\n\t\t\t\t\tlet datapoints = series[indTmp].datapoints;\r\n\t\t\t\t\tif (datapoints.length > 0) {\r\n\t\t\t\t\t\tthis.dataTemp.barsArr[i].value = datapoints[datapoints.length - 1][0];\r\n\t\t\t\t\t\ttotal = Math.round(total) + Math.round(this.dataTemp.barsArr[i].value);\r\n\t\t\t\t\t\tthis.dataTemp.barsArr[i].valueShow = unit.formatValue(this.panel, this.dataTemp.barsArr[i].value, this.panel.barsArr[i].format);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.dataTemp.barsArr[i].value = 0;\r\n\t\t\t\t\t\tthis.dataTemp.barsArr[i].valueShow = 'N/A';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttotal = Math.round(total) + Math.round(this.dataTemp.barsArr[i].value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.dataTemp.barsArr.forEach((value, index, arr) => {\r\n\t\t\t\tif (index == arr.length - 1) {\r\n\t\t\t\t\tvalue.percent = 100 - perTotal;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (value.value) {\r\n\t\t\t\t\t\tvalue.percent = (value.value / total) * 100;\r\n\t\t\t\t\t\tvalue.percent = Math.floor(value.percent);\r\n\t\t\t\t\t\tperTotal += value.percent;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue.percent = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// -----------------------------------------------------------------Bar2 数据处理-----------------------------------------------------------------\r\n\t\t\tlet total2 = 0, perTotal2 = 0, barLen = this.panel.barsArr.length;\r\n\t\t\tfor (var i = 0; i < this.dataTemp.barsArr2.length; i++) {\r\n\t\t\t\tlet indTmp = proLen + barLen + i;\r\n\t\t\t\tif (series[indTmp] && series[indTmp].datapoints) {\r\n\t\t\t\t\tlet datapoints = series[indTmp].datapoints;\r\n\t\t\t\t\tif (datapoints.length > 0) {\r\n\t\t\t\t\t\tthis.dataTemp.barsArr2[i].value = datapoints[datapoints.length - 1][0];\r\n\t\t\t\t\t\ttotal2 = Math.round(total2) + Math.round(this.dataTemp.barsArr2[i].value);\r\n\t\t\t\t\t\tthis.dataTemp.barsArr2[i].valueShow = unit.formatValue(this.panel, this.dataTemp.barsArr2[i].value, this.panel.barsArr2[i].format);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tthis.dataTemp.barsArr2[i].value = 0;\r\n\t\t\t\t\t\tthis.dataTemp.barsArr2[i].valueShow = 'N/A';\r\n\t\t\t\t\t}\r\n\t\t\t\t} else {\r\n\t\t\t\t\ttotal2 = Math.round(total2) + Math.round(this.dataTemp.barsArr2[i].value);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tthis.dataTemp.barsArr2.forEach((value, index, arr) => {\r\n\t\t\t\tif (index == arr.length - 1) {\r\n\t\t\t\t\tvalue.percent = 100 - perTotal2;\r\n\t\t\t\t} else {\r\n\t\t\t\t\tif (value.value) {\r\n\t\t\t\t\t\tvalue.percent = (value.value / total2) * 100;\r\n\t\t\t\t\t\tvalue.percent = Math.floor(value.percent);\r\n\t\t\t\t\t\tperTotal2 += value.percent;\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\tvalue.percent = 0;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t})\r\n\t\t\t// -----------------------------------------------------------------Doughnut 数据处理-----------------------------------------------------------------\r\n\t\t\tlet barLen2 = this.panel.barsArr2.length;\r\n\t\t\tif(this.dataTemp.doughnutsArr.length>0){\r\n\t\t\t\tlet dnList = this.getDoughnutList();\r\n\t\t\t\tdnList = dnList.map((item, index) => {\r\n\t\t\t\t\tlet data = [\"yellow\"];\r\n\t\t\t\t\tlet cursor = proLen + barLen + barLen2 + index * 2;\r\n\t\t\t\t\tlet active = series[cursor].datapoints;\r\n\t\t\t\t\tactive = active[active.length - 1][0];\r\n\t\t\t\t\tlet inactive = series[cursor+1].datapoints;\r\n\t\t\t\t\tinactive = inactive[inactive.length - 1][0];\r\n\t\t\t\t\tconsole.log(\"cursor:\",cursor,\"series:\",series,\"active\",active,\"inactive:\",inactive);\r\n\t\t\t\t\tfor(let i = inactive;i>0;i--){\r\n\t\t\t\t\t\tdata.push(\"#67C23A\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\tfor(let i = active;i>0;i--){\r\n\t\t\t\t\t\tdata.push(\"red\");\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn {\r\n\t\t\t\t\t\tdom: item,\r\n\t\t\t\t\t\tdata: data,\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t\tthis.draw(dnList);\t\t\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// -----------------------------------------------------------------Progress 空数据处理-----------------------------------------------------------------\r\n\t\t\tthis.dataTemp.progressArr.forEach((value, index, arr) => {\r\n\t\t\t\tvalue.value = 0;\r\n\t\t\t\tvalue.valueShow = 'N/A';\r\n\t\t\t\tvalue.percent = 0;\r\n\t\t\t})\r\n\t\t\t// -----------------------------------------------------------------Bar 空数据处理-----------------------------------------------------------------\r\n\t\t\tthis.dataTemp.barsArr.forEach((value, index, arr) => {\r\n\t\t\t\tvalue.value = 0;\r\n\t\t\t\tvalue.percent = index == 0 ? 100 : 0;\r\n\t\t\t\tvalue.valueShow = 'N/A';\r\n\t\t\t})\r\n\t\t\t// -----------------------------------------------------------------Bar2 空数据处理-----------------------------------------------------------------\r\n\t\t\tthis.dataTemp.barsArr2.forEach((value, index, arr) => {\r\n\t\t\t\tvalue.value = 0;\r\n\t\t\t\tvalue.percent = index == 0 ? 100 : 0;\r\n\t\t\t\tvalue.valueShow = 'N/A';\r\n\t\t\t})\r\n\t\t\t// -----------------------------------------------------------------Doughnut 空数据处理-----------------------------------------------------------------\r\n\t\t\t// let TestData = [[0,1], [3,2]]\r\n\t\t\t// let dnList = this.getDoughnutList();\r\n\t\t\t// dnList = dnList.map((item, index) => {\r\n\t\t\t// \tlet dnData = TestData[index];\r\n\t\t\t// \tlet data = [\"yellow\"];\r\n\t\t\t// \tfor(let i = 0;i<dnData[0];i++) {\r\n\t\t\t// \t\tdata.push(\"red\");\r\n\t\t\t// \t}\r\n\t\t\t// \tfor(let i = 0;i<dnData[1];i++) {\r\n\t\t\t// \t\tdata.push(\"#67C23A\");\r\n\t\t\t// \t}\r\n\t\t\t// \treturn {\r\n\t\t\t// \t\tdom: item,\r\n\t\t\t// \t\tdata: data,\r\n\t\t\t// \t}\r\n\t\t\t// });\r\n\t\t\t// this.draw(dnList);\r\n\t\t}\r\n\t\treturn this.dataTemp;\r\n\t}\r\n\r\n\tseriesHandler(seriesData) {\r\n\t\treturn seriesData;\r\n\t}\r\n\r\n\tonDataReceived(dataList) {\r\n\t\tthis.series = dataList.map(this.seriesHandler.bind(this));\r\n\t\tthis.data = this.parseSeries(this.series);\r\n\t\tthis.render(this.data);\r\n\t}\r\n\r\n\tgetProcessStyle(proObj) {\r\n\t\treturn { 'width': proObj && proObj.percent ? proObj.percent + \"%\" : 0 + '%' };\r\n\t}\r\n\r\n\tgetBarStyle(index) {\r\n\t\treturn { 'width': this.dataTemp.barsArr[index].percent + '%', 'background-color': this.panel.colorArr[index] };\r\n\t}\r\n\tgetBarStyle2(index) {\r\n\t\treturn { 'width': this.dataTemp.barsArr2[index].percent + '%', 'background-color': this.panel.colorArr[index] };\r\n\t}\r\n\r\n\taddProgress() {\r\n\t\tlet objTempEdit = {\r\n\t\t\tlabel: '', unit: '', type: 'solid', format: 'short'\r\n\t\t},\r\n\t\t\tobjTemp = { value: 0, valueShow: '', percent: 0 };\r\n\t\tthis.panel.progressArr.push(objTempEdit);\r\n\t\tthis.dataTemp.progressArr.push(objTemp);\r\n\t}\r\n\r\n\taddBarMember() {\r\n\t\tlet objTempEdit = {\r\n\t\t\tlabel: '', unit: '', format: 'short'\r\n\t\t},\r\n\t\tobjTemp = { value: 0, valueShow: '', percent: 0 };\r\n\t\tthis.panel.barsArr.push(objTempEdit);\r\n\t\tthis.dataTemp.barsArr.push(objTemp);\r\n\t}\r\n\r\n\taddBarMember2() {\r\n\t\tlet objTempEdit = {\r\n\t\t\tlabel: '', unit: '', format: 'short'\r\n\t\t},\r\n\t\tobjTemp = { value: 0, valueShow: '', percent: 0 };\r\n\t\tthis.panel.barsArr2.push(objTempEdit);\r\n\t\tthis.dataTemp.barsArr2.push(objTemp);\r\n\t}\r\n\r\n\t// -----------------------------------------------------------------Doughnut DOM 添加-----------------------------------------------------------------\r\n\taddDoughnutMember() {\r\n\t\tlet autoID = ()=>{\r\n\t\t\tfor(let i = 1;i>0;i++){\r\n\t\t\t\tif(document.querySelectorAll(\"#doughnut_\"+i).length==0) return i;\r\n\t\t\t}\r\n\t\t}\r\n\t\tlet objTempEdit = {\r\n\t\t\tid: autoID(), unit: '', label: '', format: 'short'\r\n\t\t},\r\n\t\tobjTemp = { value: 0, valueShow: '', percent: 0 };\r\n\t\tthis.panel.doughnutsArr.push(objTempEdit);\r\n\t\tthis.dataTemp.doughnutsArr.push(objTemp);\r\n\t}\r\n\t// -------------------------------------------------------------------------------------------------------------------------------------------------------\r\n\r\n\tdelProgress(index) {\r\n\t\tthis.panel.progressArr.splice(index, 1);\r\n\t\tthis.dataTemp.progressArr.splice(index, 1);\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tdelBarMember(index) {\r\n\t\tthis.panel.barsArr.splice(index, 1);\r\n\t\tthis.dataTemp.barsArr.splice(index, 1);\r\n\t\tlet total = 0;\r\n\t\tthis.dataTemp.barsArr.forEach((value, index, arr) => {\r\n\t\t\ttotal = Math.round(total) + Math.round(value.value);\r\n\t\t});\r\n\t\tthis.dataTemp.barsArr.forEach((value, index, arr) => {\r\n\t\t\tif (total === 0) {\r\n\t\t\t\tvalue.percent = index == 0 ? 100 : 0;\r\n\t\t\t} else {\r\n\t\t\t\tvalue.percent = (value.value / total) * 100;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.render();\r\n\t}\r\n\r\n\tdelBarMember2(index) {\r\n\t\tthis.panel.barsArr2.splice(index, 1);\r\n\t\tthis.dataTemp.barsArr2.splice(index, 1);\r\n\t\tlet total = 0;\r\n\t\tthis.dataTemp.barsArr2.forEach((value, index, arr) => {\r\n\t\t\ttotal = Math.round(total) + Math.round(value.value);\r\n\t\t});\r\n\t\tthis.dataTemp.barsArr2.forEach((value, index, arr) => {\r\n\t\t\tif (total === 0) {\r\n\t\t\t\tvalue.percent = index == 0 ? 100 : 0;\r\n\t\t\t} else {\r\n\t\t\t\tvalue.percent = (value.value / total) * 100;\r\n\t\t\t}\r\n\t\t});\r\n\t\tthis.render();\r\n\t}\r\n\r\n\t// -----------------------------------------------------------------Doughnut DOM 删除-----------------------------------------------------------------\r\n\tdelDoughnutMember(index) {\r\n\t\tthis.panel.doughnutsArr.splice(index, 1);\r\n\t\tthis.dataTemp.doughnutsArr.splice(index, 1);\r\n\t\tthis.render();\r\n\t}\r\n\t// -------------------------------------------------------------------------------------------------------------------------------------------------------\r\n\r\n\t// -----------------------------------------------------------------Doughnut DOM 绘画-----------------------------------------------------------------\r\n\tdraw(list) {\r\n\t\tconsole.log(\"progresschart.js/draw is run.\");\r\n\t\t// Doughnut 测试数据\r\n\t\tfor(let i in list) {\r\n\t\t\tlet dom = list[i].dom;\r\n\t\t\tdom.width = document.querySelectorAll(\"#doughnut_\"+this.panel.doughnutsArr[0].id)[0].clientWidth;\r\n\t\t\tdom.height = 100;\r\n\t\t\tDraw({\r\n\t\t\t\tdata: list[i].data,\r\n\t\t\t\tdom: dom,\r\n\t\t\t\twidth: dom.width,\r\n\t\t\t\theight: dom.height,\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\t// -------------------------------------------------------------------------------------------------------------------------------------------------------\r\n\t\r\n\tgetDoughnutList() {\r\n\t\tlet domList = [];\r\n\t\tfor(let i in this.panel.doughnutsArr) {\r\n\t\t\t// if(document.querySelectorAll(\".doughnut-contanier\")[i]) {\r\n\t\t\t// \tdomList.push(document.querySelectorAll(\".doughnut-contanier\")[i].children[1]);\r\n\t\t\t// }\r\n\t\t\tlet target = document.querySelectorAll(\"#doughnut_\"+this.panel.doughnutsArr[i].id)[0];\r\n\t\t\tconsole.log(\"target:\",target);\r\n\t\t\tif(target) {\r\n\t\t\t\tdomList.push(target.children[1]);\r\n\t\t\t}\r\n\t\t}\r\n\t\treturn domList;\r\n\t}\r\n\t// ---------------------------------------------圆环图初始化----------------------------------------------------------------------------------------------------------\r\n\tdoughnutInit(index, id, $event) {\r\n\t\tconsole.log(index, id, $event);\r\n\t\t// this.render();\r\n\t\t// let arr = [];\r\n\t\t// if(index == (len - 1)){\r\n\t\t// \tarr = this.getDoughnutList();\r\n\t\t// \tthis.draw(arr);\r\n\t\t// }\r\n\t}\r\n\t// -------------------------------------------------------------------------------------------------------------------------------------------------------\r\n\r\n\tlink(scope, elem) {\r\n\t\tthis.events.on('render', () => {\r\n\t\t\tconst $panelContainer = elem.find('.panel-container');\r\n\t\t\tconst $progressPanel = elem.find('.progress-panel');\r\n\t\t\t$progressPanel.css('height', ($panelContainer[0].offsetHeight - 40) + 'px');\r\n\t\t});\r\n\t}\r\n}\r\n\r\nProgressChartCtrl.templateUrl = 'module.html';\r\n"]}