{"version":3,"sources":["../src/unit.js"],"names":["kbn","unitObj","checkSeries","targets","series","seriesFull","length","fillFlag","i","j","sLen","item","filter","target","push","splice","datapoints","getDecimalsForValue","panel","value","_","isNumber","decimals","scaledDecimals","delta","dec","Math","floor","log","LN10","magn","pow","norm","size","result","max","formatValue","format","decimalInfo","formatFunc","valueFormats"],"mappings":"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","file":"unit.js","sourcesContent":["import kbn from 'app/core/utils/kbn';\n\n/**\n*public unit method\n*/\nlet unitObj = {\n\tcheckSeries: function(targets, series){\n\t\tlet seriesFull = [];\n\t\tif(targets.length == series.length){\n\t\t\treturn seriesFull = series;\n\t\t}else{\n\t\t\tlet fillFlag = false;\n\t\t\tfor(var i=0,length = targets.length; i<length; i++){\n\t\t\t\tfor(var j=0,sLen = series.length; j<sLen; j++){\n\t\t\t\t\tif(targets[i].item.filter == series[j].target){\n\t\t\t\t\t\tseriesFull.push(series[j]);\n\t\t\t\t\t\tfillFlag = false;\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}else{\n\t\t\t\t\t\tfillFlag = true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\tif(fillFlag){\n\t\t\t\t\tif(targets[i].item && targets[i].item.filter){\n\t\t\t\t\t\tseriesFull.splice(i, 0, {'target':targets[i].item.filter, datapoints:[]});\n\t\t\t\t\t}else{\n\t\t\t\t\t\tseriesFull.splice(i, 0, {'target':'', datapoints:[]});\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\treturn seriesFull;\n\t},\n\tgetDecimalsForValue: function(panel, value) {\n\t\tif (_.isNumber(panel.decimals)) {\n\t\t  return { decimals: panel.decimals, scaledDecimals: null };\n\t\t}\n\n\t\tvar delta = value / 2;\n\t\tvar dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n\t\tvar magn = Math.pow(10, -dec);\n\t\tvar norm = delta / magn; // norm is between 1.0 and 10.0\n\t\tvar size;\n\n\t\tif (norm < 1.5) {\n\t\t  size = 1;\n\t\t} else if (norm < 3) {\n\t\t  size = 2;\n\t\t  // special case for 2.5, requires an extra decimal\n\t\t  if (norm > 2.25) {\n\t\t\tsize = 2.5;\n\t\t\t++dec;\n\t\t  }\n\t\t} else if (norm < 7.5) {\n\t\t  size = 5;\n\t\t} else {\n\t\t  size = 10;\n\t\t}\n\n\t\tsize *= magn;\n\n\t\t// reduce starting decimals if not needed\n\t\tif (Math.floor(value) === value) { dec = 0; }\n\n\t\tvar result = {};\n\t\tresult.decimals = Math.max(0, dec);\n\t\tresult.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n\n\t\treturn result;\n\t  },\n\t  formatValue: function(panel, value, format) {\n\t\tvar decimalInfo = this.getDecimalsForValue(panel, value);\n\t\tvar formatFunc = kbn.valueFormats[format];\n\t\tif (formatFunc) {\n\t\t  return formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n\t\t}\n\t\treturn value;\n\t  }\n};\n\nexport default unitObj;\n\n"]}