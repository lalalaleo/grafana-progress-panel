{"version":3,"sources":["../src/unit.js"],"names":["kbn","_","unitObj","checkSeries","targets","series","seriesFull","length","fillFlag","i","j","sLen","item","filter","target","push","splice","datapoints","checkProgressArr","source","map","so","value","valueShow","percent","hasOwnProperty","getDecimalsForValue","panel","isNumber","decimals","scaledDecimals","delta","dec","Math","floor","log","LN10","magn","pow","norm","size","result","max","formatValue","format","decimalInfo","formatFunc","valueFormats"],"mappings":"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","file":"unit.js","sourcesContent":["import kbn from 'app/core/utils/kbn';\nimport _ from 'lodash';\n\n/**\n*public unit method\n*/\nlet unitObj = {\n\tcheckSeries: function(targets, series){\n\t\t\t\tlet seriesFull = [];\n\t\t\t\tif(targets.length == series.length){\n\t\t\t\t\treturn seriesFull = series;\n\t\t\t\t}else{\n\t\t\t\t\tlet fillFlag = false;\n\t\t\t\t\tfor(var i=0,length = targets.length; i<length; i++){\n\t\t\t\t\t\tfor(var j=0,sLen = series.length; j<sLen; j++){\n\t\t\t\t\t\t\tif(targets[i].item.filter == series[j].target){\n\t\t\t\t\t\t\t\tseriesFull.push(series[j]);\n\t\t\t\t\t\t\t\tfillFlag = false;\n\t\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tfillFlag = true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\tif(fillFlag){\n\t\t\t\t\t\t\tif(targets[i].item && targets[i].item.filter){\n\t\t\t\t\t\t\t\tseriesFull.splice(i, 0, {'target':targets[i].item.filter, datapoints:[]});\n\t\t\t\t\t\t\t}else{\n\t\t\t\t\t\t\t\tseriesFull.splice(i, 0, {'target':'', datapoints:[]});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\treturn seriesFull;\n\t},\n\tcheckProgressArr: function(source, target){\n        if(source.length == target.length){\n\t\t\treturn target;\n\t\t}else{\n\t\t\ttarget =  _.map(source, (so, i) => {\n\t\t\t\treturn {\n\t\t\t\t\tvalue: so.value || '',\n\t\t\t\t\tvalueShow: so.valueShow || '',\n\t\t\t\t\tpercent: so.percent || 0\n\t\t\t\t};\n\t\t\t});\n\t\t\t/*针对之前部署的信息*/\n\t\t\t_.map(source, (so, i) => {\n\t\t\t\tso.hasOwnProperty(\"value\") && delete so.value;\n\t\t\t\tso.hasOwnProperty(\"valueShow\") &&  delete so.valueShow;\n\t\t\t\tso.hasOwnProperty(\"percent\") && delete so.percent;\n\t\t\t});\n\t\t\treturn target;\n\t\t}\n\t},\n\tgetDecimalsForValue: function(panel, value) {\n\t\t\t\tif (_.isNumber(panel.decimals)) {\n\t\t\t\t\treturn { decimals: panel.decimals, scaledDecimals: null };\n\t\t\t\t}\n\n\t\t\t\tvar delta = value / 2;\n\t\t\t\tvar dec = -Math.floor(Math.log(delta) / Math.LN10);\n\n\t\t\t\tvar magn = Math.pow(10, -dec);\n\t\t\t\tvar norm = delta / magn; // norm is between 1.0 and 10.0\n\t\t\t\tvar size;\n\n\t\t\t\tif (norm < 1.5) {\n\t\t\t\t\tsize = 1;\n\t\t\t\t} else if (norm < 3) {\n\t\t\t\t\tsize = 2;\n\t\t\t\t\t// special case for 2.5, requires an extra decimal\n\t\t\t\t\tif (norm > 2.25) {\n\t\t\t\t\tsize = 2.5;\n\t\t\t\t\t++dec;\n\t\t\t\t\t}\n\t\t\t\t} else if (norm < 7.5) {\n\t\t\t\t\tsize = 5;\n\t\t\t\t} else {\n\t\t\t\t\tsize = 10;\n\t\t\t\t}\n\n\t\t\t\tsize *= magn;\n\n\t\t\t\t// reduce starting decimals if not needed\n\t\t\t\tif (Math.floor(value) === value) { dec = 0; }\n\n\t\t\t\tvar result = {};\n\t\t\t\tresult.decimals = Math.max(0, dec);\n\t\t\t\tresult.scaledDecimals = result.decimals - Math.floor(Math.log(size) / Math.LN10) + 2;\n\n\t\t\t\treturn result;\n\t  },\n\t  formatValue: function(panel, value, format) {\n\t\t\t\tvar decimalInfo = this.getDecimalsForValue(panel, value);\n\t\t\t\tvar formatFunc = kbn.valueFormats[format];\n\t\t\t\tif (formatFunc) {\n\t\t\t\t\treturn formatFunc(value, decimalInfo.decimals, decimalInfo.scaledDecimals);\n\t\t\t\t}\n\t\t\t\treturn value;\n\t  }\n};\n\nexport default unitObj;\n\n"]}